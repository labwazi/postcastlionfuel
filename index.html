<!-- Save as: ultra-simple-stream.html -->
<!DOCTYPE html>
<html>
<body>
    <h1>LionFuel Ultra-Simple Stream</h1>
    <button onclick="start()">START STREAM</button>
    <button onclick="stop()" style="background:red;color:white;">STOP</button>
    <br><br>
    <video id="myVideo" autoplay style="width:80%;border:3px solid orange;"></video>
    <br><br>
    <div id="linkBox" style="background:yellow;padding:20px;display:none;">
        <h3>ðŸ‘‡ SEND THIS LINK TO VIEWER ðŸ‘‡</h3>
        <input id="link" style="width:400px;padding:10px;">
        <button onclick="copy()" style="background:green;color:white;">COPY</button>
        <p><strong>Viewer must use CHROME browser!</strong></p>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script>
        let myStream;
        let myPeer;
        
        async function start() {
            // 1. Get camera
            myStream = await navigator.mediaDevices.getUserMedia({
                video: true,
                audio: true
            });
            
            // 2. Show my video
            document.getElementById('myVideo').srcObject = myStream;
            document.getElementById('myVideo').muted = true;
            
            // 3. Create connection
            myPeer = new Peer('lion-' + Date.now(), {
                host: '0.peerjs.com',
                port: 443,
                config: { iceServers: [
                    { urls: 'stun:stun.l.google.com:19302' },
                    { urls: 'stun:stun1.l.google.com:19302' }
                ]}
            });
            
            myPeer.on('open', (id) => {
                // 4. Generate link
                const link = window.location.href.split('?')[0] + '?watch=' + id;
                document.getElementById('link').value = link;
                document.getElementById('linkBox').style.display = 'block';
                alert('Send this link to viewer: ' + link);
            });
            
            // 5. Handle viewer
            myPeer.on('call', (call) => {
                call.answer(myStream);
                alert('Viewer connected!');
            });
        }
        
        function copy() {
            const link = document.getElementById('link');
            link.select();
            document.execCommand('copy');
            alert('Copied! Send this to viewer.');
        }
        
        function stop() {
            if (myStream) myStream.getTracks().forEach(t => t.stop());
            if (myPeer) myPeer.destroy();
            document.getElementById('myVideo').srcObject = null;
            document.getElementById('linkBox').style.display = 'none';
        }
        
        // Auto-join as viewer
        const params = new URLSearchParams(window.location.search);
        if (params.get('watch')) {
            document.body.innerHTML = '<h1>Connecting to LionFuel...</h1><video id="v" autoplay style="width:100%"></video>';
            const peer = new Peer('viewer-' + Date.now(), {host: '0.peerjs.com', port: 443});
            peer.on('open', () => {
                const call = peer.call(params.get('watch'));
                call.on('stream', (stream) => {
                    document.getElementById('v').srcObject = stream;
                    document.body.innerHTML = '<h1>LionFuel Live ðŸ”´</h1><video autoplay style="width:100%" id="v"></video>';
                    document.getElementById('v').srcObject = stream;
                });
            });
        }
    </script>
</body>
</html>
